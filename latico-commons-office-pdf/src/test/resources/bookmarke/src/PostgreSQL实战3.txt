进 阶 篇 186
第10章 性能优化                                                                 187
	10.1 服务器硬件                                                                 187
	10.2 操作系统优化                                                               188
		10.2.1 常用Linux性能工具                                                        188
		10.2.2 Linux系统的I/O调度算法                                                   196
		10.2.3 预读参数调整                                                             197
		10.2.4 内存的优化                                                               197
	10.3 数据库调优                                                                 200
		10.3.1 全局参数调整                                                             200
		10.3.2 统计信息和查询计划                                                       201
		10.3.3 索引管理与维护                                                           208
	10.4 本章小结                                                                   210
第11章 基准测试与pgbench                                                        211
	11.1 关于基准测试                                                               211
		11.1.1 基准测试的常见使用场景                                                   212
		11.1.2 基准测试衡量指标                                                         212
		11.1.3 基准测试的原则                                                           212
	11.2 使用pgbench进行测试                                                        213
		11.2.1 pgbench的测试结果报告                                                    213
		11.2.2 通过内置脚本进行测试                                                     214
		11.2.3 使用自定义脚本进行测试                                                   217
		11.2.4 其他选项                                                                 219
	11.3 本章小结                                                                   221
第12章 物理复制和逻辑复制                                                       222
	12.1 异步流复制                                                                 223
		12.1.1 以拷贝数据文件方式部署流复制                                             223
		12.1.2 以pg_basebackup方式部署流复制                                            229
		12.1.3 查看流复制同步方式                                                       230
	12.2 同步流复制                                                                 231
		12.2.1 synchronous_commit参数详解                                               231
		12.2.2 配置同步流复制                                                           232
		12.2.3 同步流复制的典型“陷阱”                                                 233
	12.3 单实例、异步流复制、同步流复制性能测试                                     234
		12.3.1 读性能测试                                                               235
		12.3.2 写性能测试                                                               237
	12.4 流复制监控                                                                 238
		12.4.1 pg_stat_replication                                                      238
		12.4.2 监控主备延迟                                                             240
		12.4.3 pg_stat_wal_receiver                                                     241
		12.4.4 相关系统函数                                                             242
	12.5 流复制主备切换                                                             243
		12.5.1 判断主备角色的五种方法                                                   243
		12.5.2 主备切换之文件触发方式                                                   245
		12.5.3 主备切换之pg_ctl promote方式                                             247
		12.5.4 pg_rewind                                                                248
	12.6 延迟备库                                                                   251
		12.6.1 延迟备库的意义                                                           251
		12.6.2 延迟备库部署                                                             251
		12.6.3 recovery_min_apply_delay参数对同步复制的影响                             253
	12.7 同步复制优选提交                                                           254
		12.7.1 synchronous_standby_names参数详解                                        255
		12.7.2 基于优先级的同步备库                                                     256
		12.7.3 基于Quorum的同步备库                                                     257
	12.8 级联复制                                                                   258
		12.8.1 级联复制物理架构                                                         259
		12.8.2 级联复制部署                                                             260
	12.9 流复制维护生产案例                                                         262
		12.9.1 案例一：主库上创建表空间时备库宕机                                       262
		12.9.2 案例二：备库查询被中止                                                   264
		12.9.3 案例三：主库上的WAL被覆盖导致备库不可用                                  266
	12.10 逻辑复制                                                                  272
		12.10.1 逻辑解析                                                                272
		12.10.2 逻辑复制架构                                                            274
		12.10.3 逻辑复制部署                                                            275
		12.10.4 逻辑复制DML数据验证                                                     280
		12.10.5 逻辑复制添加表、删除表                                                  281
		12.10.6 逻辑复制启动、停止                                                      283
		12.10.7 逻辑复制配置注意事项和限制                                              284
		12.10.8 逻辑复制延迟测试                                                        285
	12.11 本章小结                                                                  287
第13章 备份与恢复                                                               288
	13.1 备份与恢复概述                                                             288
	13.2 增量备份                                                                   290
		13.2.1 开启WAL归档                                                              291
		13.2.2 创建基础备份                                                             292
	13.3 指定时间和还原点的恢复                                                     295
		13.3.1 恢复到最近时间点                                                         296
		13.3.2 恢复到指定时间点                                                         298
		13.3.3 恢复到指定还原点                                                         299
		13.3.4 恢复到指定事务                                                           301
		13.3.5 恢复到指定时间线                                                         303
	13.4 SQL转储和文件系统级别的备份                                                305
		13.4.1 SQL转储                                                                  305
		13.4.2 文件系统级别的备份                                                       308
	13.5 本章小结                                                                   308
第14章 高可用                                                                   309
	14.1 Pgpool-II+异步流复制实现高可用                                             310
		14.1.1 pgpool部署架构图                                                         311
		14.1.2 pgpool部署                                                               312
		14.1.3 PCP管理接口配置                                                          319
		14.1.4 pgpool方案高可用测试                                                     320
		14.1.5 pgpool方案常见错误处理                                                   325
	14.2 基于Keepalived+异步流复制实现高可用                                        328
		14.2.1 Keepalived+异步流复制部署架构图                                          328
		14.2.2 Keepalived+异步流复制高可用方案部署                                      329
		14.2.3 Keepalived配置                                                           331
		14.2.4 Keepalived方案高可用测试                                                 336
	14.3 本章小结                                                                   340
第15章 版本升级                                                                 341
	15.1 版本介绍                                                                   341
	15.2 小版本升级                                                                 342
	15.3 大版本升级                                                                 343
		15.3.1 通过pg_dumpall进行大版本升级                                             343
		15.3.2 通过pg_upgrade进行大版本升级                                             346
		15.3.3 使用pglogical升级大版本                                                  353
	15.4 本章小结                                                                   357
第16章 扩展模块                                                                 358
	16.1 CREATE EXTENSION                                                           358
	16.2 pg_stat_statements                                                         360
	16.3 auto_explain                                                               363
	16.4 pg_prewarm                                                                 364
	16.5 file_fdw                                                                   366
		16.5.1 SQL/MED简介                                                              366
		16.5.2 file_fdw部署                                                             367
		16.5.3 使用file_fdw分析数据库日志                                               369
	16.6 postgres_fdw                                                               371
		16.6.1 postgres_fdw部署                                                         371
		16.6.2 postgres_fdw外部表支持写操作                                             373
		16.6.3 postgres_fdw支持聚合函数下推                                             374
	16.7 Citus                                                                      376
		16.7.1 Citus特性                                                                377
		16.7.2 Citus安装                                                                377
		16.7.3 Citus管理                                                                379
		16.7.4 创建分布表                                                               380
		16.7.5 Citus参数配置                                                            380
		16.7.6 Citus常用功能                                                            381
	16.8 本章小结                                                                   384
第17章 Oracle数据库迁移PostgreSQL实践                                           385
	17.1 项目准备                                                                   385
	17.2 数据库对象迁移                                                             386
	17.3 应用代码改造                                                               387
	17.4 数据迁移测试                                                               391
	17.5 功能测试和性能测试                                                         395
	17.6 生产割接                                                                   396
	17.7 oracle_fdw部署过程中的常见错误                                             396
	17.8 本章小结                                                                   398
第18章 PostGIS                                                                  399
	18.1 安装与配置                                                                 399
	18.2 创建GIS数据库                                                              400
	18.3 几何对象                                                                   400
		18.3.1 几何对象的输入                                                           401
		18.3.2 几何对象的存储                                                           401
		18.3.3 几何对象的输出                                                           402
		18.3.4 几何对象的运算                                                           402
	18.4 应用场景：圈人与地理围栏                                                   404
		18.4.1 空间索引                                                                 405
		18.4.2 地理围栏                                                                 406
	18.5 本章小结                                                                   406
