目录	9
第1章　Activiti介绍	16
	1.1　工作流介绍	17
	1.2　BPMN 2.0规范简述	17
		1.2.1　BPMN 2.0概述	18
		1.2.2　BPMN 2.0元素	18
		1.2.3　BPMN 2.0的XML结构	20
	1.3　Activiti介绍	20
		1.3.1　Activiti的出现	20
		1.3.2　Activiti的发展	20
		1.3.3　选择Activiti还是jBPM	20
	1.4　本章小结	21
第2章　安装与运行Activiti	22
	2.1　下载与运行Activiti	23
		2.1.1　下载和安装JDK	23
		2.1.2　下载和安装MySQL	24
		2.1.3　下载和安装Activiti	25
	2.2　运行官方的Activiti示例	26
		2.2.1　请假流程概述	26
		2.2.2　新建用户	26
		2.2.3　定义流程	27
		2.2.4　发布流程	29
		2.2.5　启动与完成流程	30
		2.2.6　流程引擎管理	31
	2.3　安装开发环境	32
		2.3.1　下载Eclipse	32
		2.3.2　安装Activiti插件	33
	2.4　编写第一个Activiti程序	34
		2.4.1　如何运行本书示例	34
		2.4.2　建立工程环境	34
		2.4.3　创建配置文件	35
		2.4.4　创建流程文件	35
		2.4.5　加载流程文件与启动流程	36
	2.5　本章小结	37
第3章　Activiti数据库设计	38
	3.1　通用数据表	39
		3.1.1　资源表	39
		3.1.2　属性表	39
	3.2　流程存储表	40
		3.2.1　部署数据表	40
		3.2.2　流程定义表	40
	3.3　身份数据表	40
		3.3.1　用户表	40
		3.3.2　用户账号（信息）表	41
		3.3.3　用户组表	41
		3.3.4　关系表	41
	3.4　运行时数据表	41
		3.4.1　流程实例（执行流）表	41
		3.4.2　流程任务表	42
		3.4.3　流程参数表	42
		3.4.4　流程与身份关系表	42
		3.4.5　工作数据表	43
		3.4.6　事件描述表	43
	3.5　历史数据表	43
		3.5.1　流程实例表	43
		3.5.2　流程明细表	44
		3.5.3　历史任务表和历史行为表	44
		3.5.4　附件表和评论表	44
	3.6　DMN规则引擎表	45
		3.6.1　决策部署表	45
		3.6.2　决策表	45
		3.6.3　部署资源表	45
	3.7　本章小结	45
第4章　Activiti流程引擎配置	46
	4.1　流程引擎配置对象	47
		4.1.1　读取默认的配置文件	47
		4.1.2　读取自定义的配置文件	48
		4.1.3　读取输入流的配置	48
		4.1.4　使用createStandaloneInMemProcess- EngineConfiguration方法	49
		4.1.5　使用createStandaloneProcessEngine- Configuration方法	49
	4.2　数据源配置	50
		4.2.1　Activiti支持的数据库	50
		4.2.2　Activiti与Spring	50
		4.2.3　JDBC配置	50
		4.2.4　DBCP数据源配置	51
		4.2.5　C3P0数据源配置	52
		4.2.6　Activiti其他数据源配置	53
		4.2.7　数据库策略配置	53
		4.2.8　databaseType配置	54
	4.3　其他属性配置	55
		4.3.1　history配置	55
		4.3.2　asyncExecutorActivate配置	56
		4.3.3　邮件服务器配置	56
	4.4　ProcessEngineConfiguration bean	56
		4.4.1　ProcessEngineConfiguration及其子类	56
		4.4.2　自定义ProcessEngineConfiguration	57
	4.5　Activiti的命令拦截器	58
		4.5.1　命令模式	59
		4.5.2　责任链模式	60
		4.5.3　编写自定义拦截器	62
	4.6　本章小结	64
第5章　流程引擎的创建	65
	5.1　ProcessEngineConfiguration的buildProcessEngine方法	66
	5.2　ProcessEngines对象	66
		5.2.1　init方法与getDefaultProcessEngine方法	66
		5.2.2　registerProcessEngine方向和unregister方法	67
		5.2.3　retry方法	68
		5.2.4　destroy方法	68
	5.3　ProcessEngine对象	69
		5.3.1　服务组件	69
		5.3.2　关闭流程引擎	70
		5.3.3　流程引擎名称	71
	5.4　本章小结	71
第6章　用户组与用户	72
	6.1　用户组管理	73
		6.1.1　Group对象	73
		6.1.2　创建用户组	73
		6.1.3　修改用户组	74
		6.1.4　删除用户组	75
	6.2　Activiti数据查询	76
		6.2.1　查询对象	76
		6.2.2　list方法	76
		6.2.3　listPage方法	77
		6.2.4　count方法	78
		6.2.5　排序方法	78
		6.2.6　ID排序问题	79
		6.2.7　多字段排序	81
		6.2.8　singleResult方法	82
		6.2.9　用户组数据查询	83
		6.2.10　原生SQL查询	84
	6.3　用户管理	86
		6.3.1　User对象	86
		6.3.2　添加用户	86
		6.3.3　修改用户	87
		6.3.4　删除用户	87
		6.3.5　验证用户密码	88
		6.3.6　用户数据查询	89
		6.3.7　设置认证用户	90
	6.4　用户信息管理	92
		6.4.1　添加和删除用户信息	92
		6.4.2　查询用户信息	93
		6.4.3　设置用户图片	93
	6.5　用户组与用户的关系	95
		6.5.1　绑定关系	95
		6.5.2　解除绑定	96
		6.5.3　查询用户组下的用户	96
		6.5.4　查询用户所属的用户组	97
	6.6　本章小结	98
第7章　流程存储	99
	7.1　流程文件部署	100
		7.1.1　Deployment对象	100
		7.1.2　DeploymentBuilder对象	100
		7.1.3　添加输入流资源	101
		7.1.4　添加classpath资源	102
		7.1.5　添加字符串资源	103
		7.1.6　添加压缩包资源	103
		7.1.7　添加BPMN模型资源	104
		7.1.8　修改部署信息	105
		7.1.9　过滤重复部署	105
		7.1.10　取消部署时的验证	107
	7.2　流程定义的管理	108
		7.2.1　ProcessDefinition对象	108
		7.2.2　流程部署	108
		7.2.3　流程图部署	110
		7.2.4　流程图自动生成	110
		7.2.5　中止与激活流程定义	111
		7.2.6　流程定义缓存配置	112
		7.2.7　自定义缓存	113
	7.3　流程定义权限	115
		7.3.1　设置流程定义的用户权限	115
		7.3.2　设置流程定义的用户组权限	116
		7.3.3　IdentityLink对象	117
		7.3.4　查询权限数据	117
	7.4　RepositoryService数据查询与删除	119
		7.4.1　查询部署资源	119
		7.4.2　查询流程文件	120
		7.4.3　查询流程图	121
		7.4.4　查询部署资源名称	122
		7.4.5　删除部署资源	122
		7.4.6　DeploymentQuery对象	123
		7.4.7　ProcessDefinitionQuery对象	124
	7.5　本章小结	124
第8章　流程任务管理	125
	8.1　任务的创建与删除	126
		8.1.1　Task接口	126
		8.1.2　创建与保存Task实例	127
		8.1.3　删除任务	127
	8.2　任务权限	128
		8.2.1　设置候选用户组	129
		8.2.2　设置候选用户	130
		8.2.3　权限数据查询	131
		8.2.4　设置任务持有人	133
		8.2.5　设置任务代理人	134
		8.2.6　添加任务权限数据	134
		8.2.7　删除用户组权限	136
		8.2.8　删除用户权限	137
	8.3　任务参数	138
		8.3.1　基本类型参数设置	139
		8.3.2　序列化参数	140
		8.3.3　获取参数	141
		8.3.4　参数作用域	142
		8.3.5　设置多个参数	143
		8.3.6　数据对象	144
	8.4　任务附件管理	145
		8.4.1　Attachment对象	145
		8.4.2　创建任务附件	145
		8.4.3　附件查询	147
		8.4.4　删除附件	148
	8.5　任务评论与事件记录	148
		8.5.1　Comment对象	148
		8.5.2　新增任务评论	149
		8.5.3　事件的记录	150
		8.5.4　数据查询	151
	8.6　任务声明与完成	152
		8.6.1　任务声明	152
		8.6.2　任务完成	153
	8.7　本章小结	154
第9章　流程控制	155
	9.1　流程实例与执行流	156
		9.1.1　流程实例与执行流概念	156
		9.1.2　流程实例和执行流对象（ProcessInstance与Execution）	156
	9.2　启动流程	157
		9.2.1　startProcessInstanceById方法	157
		9.2.2　startProcessInstanceByKey方法	159
		9.2.3　startProcessInstanceByMessage	160
	9.3　流程参数	161
		9.3.1　设置与查询流程参数	162
		9.3.2　流程参数的作用域	162
		9.3.3　其他设置参数的方法	164
	9.4　流程操作	164
		9.4.1　流程触发	164
		9.4.2　触发信号事件	165
		9.4.3　触发消息事件	167
		9.4.4　中断与激活流程	168
		9.4.5　删除流程	169
	9.5　流程数据查询	170
		9.5.1　执行流查询	170
		9.5.2　流程实例查询	172
	9.6　本章小结	173
第10章　历史数据管理和流程引擎管理	174
	10.1　历史数据管理	175
		10.1.1　历史流程实例查询	175
		10.1.2　历史任务查询	176
		10.1.3　历史行为查询	178
		10.1.4　历史流程明细查询	180
		10.1.5　删除历史流程实例和历史任务	181
	10.2　工作的产生	182
		10.2.1　异步任务产生的工作	183
		10.2.2　定时中间事件产生的工作	184
		10.2.3　定时边界事件产生的工作	185
		10.2.4　定时开始事件产生的工作	186
		10.2.5　流程抛出事件产生的工作	187
		10.2.6　暂停工作的产生	189
		10.2.7　无法执行的工作	190
	10.3　工作管理	191
		10.3.1　工作查询对象	191
		10.3.2　获取工作异常信息	191
		10.3.3　转移与删除工作	192
	10.4　数据库管理	193
		10.4.1　查询引擎属性	193
		10.4.2　数据表信息查询	194
		10.4.3　数据库操作	195
		10.4.4　数据表查询	195
	10.5　本章小结	196
第11章　流程事件	197
	11.1　事件分类	198
		11.1.1　按照事件的位置分类	198
		11.1.2　按照事件的特性分类	198
	11.2　事件定义	198
		11.2.1　定时器事件定义	199
		11.2.2　cron表达式	199
		11.2.3　错误事件定义	201
		11.2.4　信号事件定义	201
		11.2.5　消息事件定义	202
		11.2.6　取消事件定义	202
		11.2.7　补偿事件定义	203
		11.2.8　其他事件定义	203
	11.3　开始事件	203
		11.3.1　无指定开始事件	203
		11.3.2　定时器开始事件	204
		11.3.3　消息开始事件	205
		11.3.4　错误开始事件	206
	11.4　结束事件	208
		11.4.1　无指定结束事件	208
		11.4.2　错误结束事件	209
		11.4.3　取消结束事件和取消边界事件	211
		11.4.4　终止结束事件	214
	11.5　边界事件	215
		11.5.1　定时器边界事件	216
		11.5.2　错误边界事件	218
		11.5.3　信号边界事件	219
		11.5.4　补偿边界事件	221
	11.6　中间事件	224
		11.6.1　中间事件分类	224
		11.6.2　定时器中间事件	225
		11.6.3　信号中间Catching事件	226
		11.6.4　信号中间Throwing事件	228
		11.6.5　消息中间事件	230
		11.6.6　无指定中间事件	230
	11.7　补偿中间事件	230
		11.7.1　补偿执行次数	230
		11.7.2　补偿的执行顺序	232
		11.7.3　补偿的参数设置	235
	11.8　本章小结	236
第12章　流程任务	237
	12.1　BPMN 2.0任务	238
		12.1.1　任务的继承	238
		12.1.2　XML约束	238
		12.1.3　任务的类型	240
	12.2　用户任务	241
		12.2.1　分配任务候选人	241
		12.2.2　分配任务代理人	243
		12.2.3　权限分配扩展	243
		12.2.4　使用任务监听器进行权限分配	244
		12.2.5　使用JUEL分配权限	245
	12.3　脚本任务	247
		12.3.1　脚本任务	247
		12.3.2　JavaScript脚本	248
		12.3.3　Groovy脚本	249
		12.3.4　设置返回值	250
		12.3.5　JUEL脚本	251
	12.4　服务任务	252
		12.4.1　Java服务任务	253
		12.4.2　实现JavaDelegate	253
		12.4.3　使用普通Java Bean	255
		12.4.4　在Activiti中调用Web Service	256
		12.4.5　import元素	257
		12.4.6　itemDefinition和message元素	257
		12.4.7　interface与operation元素	258
		12.4.8　设置Web Service参数与返回值	258
		12.4.9　发布Web Service	258
		12.4.10　使用Web Service Task	260
		12.4.11　JavaDelegate属性注入	263
		12.4.12　在JavaDelegate中调用Web Service	266
		12.4.13　Shell任务	268
	12.5　其他任务	270
		12.5.1　手动任务和接收任务	270
		12.5.2　邮件任务	272
		12.5.3　Mule任务和业务规则任务	273
	12.6　任务监听器	274
		12.6.1　使用class指定监听器	274
		12.6.2　使用expression指定监听器	275
		12.6.3　使用delegateExpression指定监听器	276
		12.6.4　监听器的触发	277
		12.6.5　属性注入	278
	12.7　流程监听器	278
		12.7.1　配置流程监听器	278
		12.7.2　触发流程监听器的事件	279
	12.8　本章小结	282
第13章　其他流程元素	283
	13.1　子流程	284
		13.1.1　嵌入式子流程	284
		13.1.2　调用式子流程	286
		13.1.3　调用式子流程的参数传递	288
		13.1.4　事件子流程	290
		13.1.5　事务子流程	292
		13.1.6　特别子流程	295
	13.2　顺序流	297
		13.2.1　条件顺序流	297
		13.2.2　默认顺序流	299
	13.3　流程网关	301
		13.3.1　单向网关	301
		13.3.2　并行网关	303
		13.3.3　兼容网关	306
		13.3.4　事件网关	308
	13.4　流程活动特性	310
		13.4.1　多实例活动	310
		13.4.2　设置循环数据	312
		13.4.3　获取循环元素	313
		13.4.4　循环的内置参数	315
		13.4.5　循环结束条件	317
		13.4.6　补偿处理者	319
	13.5　本章小结	319
第14章　Activiti与规则引擎	320
	14.1　概述	321
		14.1.1　规则引擎Drools	321
		14.1.2　Drools下载与安装	321
	14.2　开发第一个Drools应用	322
		14.2.1　建立Drools环境	322
		14.2.2　编写规则	323
		14.2.3　加载与运行	323
	14.3　Drools规则语法概述	324
		14.3.1　规则文件结构	324
		14.3.2　关键字	325
		14.3.3　规则编译	325
	14.4　类型声明	326
		14.4.1　声明新类型	327
		14.4.2　使用ASM操作字节码	328
		14.4.3　类型声明的使用	329
		14.4.4　类型的继承	331
		14.4.5　声明元数据	332
	14.5　函数和查询	332
		14.5.1　函数定义和使用	333
		14.5.2　查询的定义和使用	335
	14.6　规则语法	336
		14.6.1　全局变量	337
		14.6.2　规则属性	338
		14.6.3　条件语法	342
		14.6.4　行为语法	345
	14.7　Activiti调用规则	346
		14.7.1　业务规则任务	347
		14.7.2　制定销售单优惠规则	348
		14.7.3　实现销售流程	351
	14.8　本章小结	354
第15章　基于DMN的Activiti规则引擎	355
	15.1　DMN规范概述	356
		15.1.1　DMN的出现背景	356
		15.1.2　Activiti与Drools	356
		15.1.3　DMN的XML样例	356
	15.2　DMN的XML规范	357
		15.2.1　决策	357
		15.2.2　决策表	358
		15.2.3　输入参数	358
		15.2.4　输出结果	359
		15.2.5　规则	359
	15.3　运行第一个应用	360
		15.3.1　建立项目	360
		15.3.2　规则引擎配置文件	361
		15.3.3　编写DMN文件	361
		15.3.4　加载与运行DMN文件	362
	15.4　规则引擎API简述	363
		15.4.1　创建规则引擎	363
		15.4.2　配置规则引擎	364
		15.4.3　数据查询	365
		15.4.4　执行DMN文件	365
	15.5　规则匹配	366
		15.5.1　MVEL表达式简介	366
		15.5.2　执行第一个表达式	366
		15.5.3　使用对象执行表达式	367
		15.5.4　规则引擎规则匹配逻辑	368
		15.5.5　自定义表达式函数	369
		15.5.6　Activiti中的自定义表达式函数	370
		15.5.7　销售打折案例	372
	15.6　本章小结	375
第16章　整合第三方框架	376
	16.1　Spring Framework	377
		16.1.1　Spring的IoC	377
		16.1.2　Spring的AOP	377
		16.1.3　使用IoC	378
		16.1.4　使用AOP	379
	16.2　Activiti整合Spring	380
		16.2.1　SpringProcessEngineConfiguration	380
		16.2.2　资源的部署模式	382
		16.2.3　ProcessEngineFactoryBean	382
		16.2.4　在bean中注入Activiti服务	383
		16.2.5　在Activiti中使用Spring的bean	384
	16.3　Activiti整合Web项目	386
		16.3.1　安装Tomcat插件	386
		16.3.2　加入Spring	388
		16.3.3　整合Hibernate	390
		16.3.4　配置声明式事务	392
		16.3.5　添加Struts配置	393
		16.3.6　实现一个最简单的逻辑	393
		16.3.7　测试事务	395
		16.3.8　添加Activiti	395
	16.4　Activiti与Spring Boot	396
		16.4.1　Spring Boot项目简介	396
		16.4.2　下载与安装Maven	397
		16.4.3　开发第一个Web应用	398
		16.4.4　Activiti与Spring Boot的整合	401
	16.5　Activiti与JPA	403
		16.5.1　建立与运行JPA项目	403
		16.5.2　在Activiti中使用JPA	405
		16.5.3　Activiti、Spring与JPA的整合	406
		16.5.4　基于JPA的例子	408
	16.6　本章小结	410
第17章　Activiti开放的Web Service	411
	17.1　Web Service简介	412
		17.1.1　Web Service	412
		17.1.2　SOAP协议	412
		17.1.3　REST架构	412
		17.1.4　REST的设计准则	413
		17.1.5　REST的主要特性	413
		17.1.6　SOAP RPC与REST的区别	414
	17.2　使用Sping MVC发布REST	414
		17.2.1　在Web项目中加入Spring MVC	415
		17.2.2　发布REST的Web Service	416
		17.2.3　使用Restlet编写客户端	417
		17.2.4　使用CXF编写客户端	417
		17.2.5　使用HttpClient编写客户端	418
		17.2.6　准备测试数据	418
		17.2.7　部署Activiti的Web Service	418
		17.2.8　接口访问权限	419
		17.2.9　访问Activiti接口	419
	17.3　流程存储服务	420
		17.3.1　上传部署文件	420
		17.3.2　部署数据查询	421
		17.3.3　部署资源查询	421
		17.3.4　查询单个部署资源	422
		17.3.5　删除部署	423
	17.4　本章小结	424
第18章　Activiti功能进阶	425
	18.1　流程控制逻辑	426
		18.1.1　概述	426
		18.1.2　设计流程对象	426
		18.1.3　创建流程节点行为类	428
		18.1.4　编写业务处理类	429
		18.1.5　将流程XML转换为Java对象	429
		18.1.6　编写客户端代码	431
	18.2　Activiti的表单	431
		18.2.1　概述	431
		18.2.2　表单属性	432
		18.2.3　外部表单	433
		18.2.4　关于动态工作流和动态表单	434
	18.3　流程图XML	434
		18.3.1　节点元素	434
		18.3.2　衔接元素	435
		18.3.3　流程图与流程文件的转换	435
	18.4　流程操作	436
		18.4.1　流程回退	436
		18.4.2　会签	437
	18.5　本章小结	439
第19章　办公自动化系统	440
	19.1　使用技术	441
		19.1.1　表现层技术	441
		19.1.2　MVC框架	441
		19.1.3　Spring和Hibernate	441
	19.2　功能简述	442
		19.2.1　系统的角色管理	442
		19.2.2　薪资计算流程	442
		19.2.3　请假流程	442
		19.2.4　薪资调整流程	442
		19.2.5　报销流程	443
	19.3　框架整合	443
		19.3.1　创建Web项目	443
		19.3.2　整合Spring	444
		19.3.3　整合Hibernate	445
		19.3.4　整合Struts2	447
		19.3.5　整合Activiti	448
	19.4　数据库设计	449
		19.4.1　薪资表	449
		19.4.2　请假记录表	449
		19.4.3　薪资调整记录表	450
		19.4.4　报销记录表	451
	19.5　初始化数据	452
		19.5.1　初始化角色数据	452
		19.5.2　薪资计算流程	453
		19.5.3　请假流程	454
		19.5.4　报销流程	454
		19.5.5　薪资调整流程	455
	19.6　角色管理	456
		19.6.1　用户组管理	457
		19.6.2　用户列表	458
		19.6.3　新建用户	460
		19.6.4　用户登录	461
	19.7　流程启动	462
		19.7.1　启动请假流程	462
		19.7.2　启动报销流程	465
		19.7.3　启动薪资调整流程	467
	19.8　申请列表	468
		19.8.1　申请列表的实现	468
		19.8.2　请假申请列表	469
		19.8.3　报销申请列表	470
		19.8.4　薪资调整列表	470
		19.8.5　查看流程图	471
	19.9　流程任务	472
		19.9.1　待办任务列表	472
		19.9.2　领取任务与受理任务列表	474
		19.9.3　查询任务信息	475
		19.9.4　任务审批	477
		19.9.5　运行OA的流程	478
	19.10　本章小结	478
