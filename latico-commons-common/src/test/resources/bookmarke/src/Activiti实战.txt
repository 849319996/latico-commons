
目录                                                                            11
前言                                                                            5
第一部分 准备篇 18
第1章 认识Activiti                                                              19
	1.1 什么是Activiti                                                              19
	1.2 工作流基础                                                                  20
		1.2.1 什么是BPM                                                                 20
		1.2.2 工作流生命周期                                                            21
		1.2.3 什么是BPMN                                                                22
	1.3 Activiti的特点                                                              22
	1.4 Activiti的应用                                                              23
	1.5 Activiti架构与组件                                                          24
	1.6 Activiti与jBPM5比较                                                         25
	1.7 本章小结                                                                    26
第2章 搭建Activiti开发环境                                                      27
	2.1 下载Activiti                                                                27
		2.1.1 目录结构                                                                  27
		2.1.2 Javadocs                                                                  29
	2.2 环境配置检查                                                                31
		2.2.1 检查并安装JDK                                                             31
		2.2.2 检查并安装Ant                                                             31
		2.2.3 检查并安装Maven                                                           32
	2.3 配置文件介绍                                                                33
		2.3.1 Activiti配置文件                                                          33
		2.3.2 Maven配置文件                                                             34
	2.4 Hello World                                                                 35
		2.4.1 最简单的流程定义                                                          35
		2.4.2 创建单元测试类                                                            37
		2.4.3 运行Hello World                                                           38
		2.4.4 添加业务节点                                                              38
	2.5 Activiti Explorer                                                           42
		2.5.1 配置并运行Activiti Explorer                                               42
		2.5.2 使用Activiti Explorer                                                     43
	2.6 本章小结                                                                    46
第二部分基础篇 48
第3章 流程设计工具                                                              49
	3.1 基于B/S架构的流程设计器Activiti Modeler                                     49
		3.1.1 Activiti Modeler特点                                                      49
		3.1.2 下载signavio-core-components                                              50
		3.1.3 配置打包与运行                                                            50
		3.1.4 Windows用户打包                                                           53
		3.1.5 设计请假流程                                                              54
		3.1.6 导出bpmn2.0.xml                                                           58
	3.2 在Activiti Explorer中使用Activiti Modeler                                   58
	3.3 基于Eclipse插件的流程设计器Activiti Designer                                61
		3.3.1 Activiti Designer特点                                                     61
		3.3.2 安装Activiti Designer                                                     62
		3.3.3 设计流程                                                                  63
		3.3.4 自动化                                                                    68
		3.3.5 升级历史遗留的流程设计                                                    72
		3.3.6 导入Activiti Modeler设计                                                  73
		3.3.7 泳池与泳道                                                                74
		3.3.8 在Activiti Designer中使用泳道与泳池                                       75
	3.4 本章小结                                                                    77
第4章 Activiti与BPMN 2.0规范                                                    78
	4.1 启动事件与结束事件                                                          79
		4.1.1 启动事件                                                                  79
		4.1.2 结束事件                                                                  83
	4.2 顺序流                                                                      86
		4.2.1 标准顺序流                                                                86
		4.2.2 条件顺序流                                                                86
	4.3 任务                                                                        87
		4.3.1 用户任务                                                                  87
		4.3.2 脚本任务                                                                  90
		4.3.3 Java Service任务                                                          91
		4.3.4 Web Service任务                                                           92
		4.3.5 业务规则任务                                                              93
		4.3.6 邮件任务                                                                  94
		4.3.7 Camel任务                                                                 96
		4.3.8 Mule任务                                                                  97
		4.3.9 手动任务                                                                  98
		4.3.10 接收任务                                                                 98
		4.3.11 Shell任务                                                                98
		4.3.12 多实例                                                                   99
	4.4 网关                                                                        102
		4.4.1 排他网关                                                                  102
		4.4.2 并行网关                                                                  104
		4.4.3 包容网关                                                                  106
		4.4.4 事件网关                                                                  107
	4.5 子流程与调用活动                                                            109
		4.5.1 子流程                                                                    109
		4.5.2 调用活动                                                                  111
		4.5.3 事件子流程                                                                112
		4.5.4 事务子流程                                                                114
	4.6 边界与中间事件                                                              115
		4.6.1 边界事件                                                                  116
		4.6.2 中间捕获事件                                                              120
		4.6.3 中间抛出事件                                                              124
	4.7 监听器                                                                      126
		4.7.1 执行监听器                                                                126
		4.7.2 任务监听器                                                                128
	4.8 本章小结                                                                    129
第三部分实战篇 132
第5章 用户与组及部署管理                                                        133
	5.1 用户与组                                                                    133
		5.1.1 用户                                                                      134
		5.1.2 组                                                                        135
		5.1.3 用户与组的关系                                                            136
		5.1.4 用户任务中的用户与组                                                      137
	5.2 部署流程资源                                                                143
		5.2.1 classpath方式                                                             143
		5.2.2 InputStream方式                                                           145
		5.2.3 字符串方式                                                                145
		5.2.4 zip/bar格式压缩包方式                                                     146
	5.3 流程部署及资源读取                                                          148
		5.3.1 读取已部署流程定义                                                        150
		5.3.2 从客户端部署流程                                                          151
		5.3.3 读取流程定义的XML                                                         154
		5.3.4 读取流程定义的图片及图片中的中文乱码                                      155
		5.3.5 删除部署                                                                  160
	5.4 本章小结                                                                    161
第6章 任务表单                                                                  162
	6.1 动态表单                                                                    162
		6.1.1 流程定义                                                                  163
		6.1.2 单元测试                                                                  168
		6.1.3 在Activiti Explorer中运行流程                                             171
	6.2 实现自己的Activiti Explorer                                                 177
		6.2.1 完善身份验证功能                                                          177
		6.2.2 流程启动表单                                                              179
		6.2.3 任务签收与办理                                                            182
		6.2.4 自定义表单的字段类型                                                      186
	6.3 外置表单                                                                    188
		6.3.1 流程定义                                                                  189
		6.3.2 单元测试                                                                  190
		6.3.3 自定义表单引擎                                                            191
		6.3.4 读取流程启动表单                                                          192
		6.3.5 任务签收与办理                                                            196
	6.4 本章小结                                                                    198
第7章 Activiti与容器集成                                                        199
	7.1 流程引擎工厂                                                                199
		7.1.1 创建引擎的方式                                                            199
		7.1.2 配置 ProcessEngineFactory-Bean                                            200
	7.2 自动部署流程定义                                                            204
	7.3 表达式                                                                      206
		7.3.1 表达式基础                                                                206
		7.3.2 表达式示例                                                                207
		7.3.3 使用Spring管理变量                                                        210
	7.4 监听器                                                                      212
	7.5 Spring容器集成应用实例                                                      216
		7.5.1 业务建模                                                                  217
		7.5.2 启动流程                                                                  217
		7.5.3 任务读取                                                                  220
		7.5.4 任务办理                                                                  221
	7.6 使用Spring注解初始化引擎                                                    225
		7.6.1 使用@EnableActiviti注解                                                   225
		7.6.2 使用Spring Boot初始化引擎                                                 227
	7.7 CDI模块                                                                     229
		7.7.1 启动示例                                                                  229
		7.7.2 引擎配置与流程定义                                                        230
		7.7.3 流程定义与启动                                                            231
		7.7.4 任务办理与完成                                                            235
		7.7.5 事件监听                                                                  237
	7.8 本章小结                                                                    238
第8章 邮件服务                                                                  239
	8.1 配置与测试                                                                  239
		8.1.1 搭建邮件系统                                                              239
		8.1.2 通过Activiti的邮件任务发送邮件                                            243
		8.1.3 使用Gmail发送邮件                                                         244
	8.2 与业务集成                                                                  246
		8.2.1 即时发送邮件                                                              246
		8.2.2 定时发送邮件                                                              248
	8.3 本章小结                                                                    250
第9章 多实例                                                                    251
	9.1 非用户任务                                                                  251
	9.2 用户任务多实例                                                              253
		9.2.1 顺序方式办理                                                              253
		9.2.2 并行方式办理                                                              254
		9.2.3 设置结束条件                                                              255
	9.3 应用实例—请假会签                                                          257
		9.3.1 流程定义                                                                  257
		9.3.2 任务办理                                                                  260
	9.4 审批意见                                                                    262
	9.5 本章小结                                                                    264
第10章 子流程与调用活动                                                         265
	10.1 子流程                                                                     266
		10.1.1 流程定义                                                                 267
		10.1.2 流程办理                                                                 270
		10.1.3 分析流程数据                                                             272
	10.2 调用活动                                                                   273
		10.2.1 流程定义                                                                 273
		10.2.2 单元测试                                                                 275
		10.2.3 流程办理                                                                 276
		10.2.4 分析流程数据                                                             277
	10.3 事件子流程                                                                 278
		10.3.1 流程定义                                                                 279
		10.3.2 单元测试                                                                 280
	10.4 多实例支持                                                                 281
	10.5 本章小结                                                                   283
第11章 事件                                                                     284
	11.1 启动事件                                                                   284
		11.1.1 定时启动事件                                                             284
		11.1.2 消息启动事件                                                             288
	11.2 结束事件                                                                   291
	11.3 边界事件                                                                   293
		11.3.1 异常边界事件                                                             293
		11.3.2 消息边界事件                                                             295
		11.3.3 信号边界事件                                                             299
	11.4 中间事件                                                                   301
	11.5 本章小结                                                                   303
第12章 用户任务与附件                                                           304
	12.1 用户任务                                                                   305
		12.1.1 改进任务列表                                                             305
		12.1.2 改进任务表单                                                             306
		12.1.3 任务相关人员                                                             308
		12.1.4 反签收任务                                                               312
		12.1.5 候选人与候选组                                                           313
		12.1.6 改进任务查询                                                             315
	12.2 子任务                                                                     316
	12.3 手动任务                                                                   319
	12.4 附件                                                                       320
	12.5 改进意见列表                                                               322
	12.6 任务委派                                                                   324
		12.6.1 单元测试                                                                 325
		12.6.2 任务表单中的委派                                                         326
	12.7 本章小结                                                                   327
第13章 流程数据查询与跟踪                                                       329
	13.1 Query API简介                                                              329
	13.2 运行时数据查询                                                             331
		13.2.1 任务查询                                                                 331
		13.2.2 查询参与的流程                                                           334
	13.3 流程图跟踪                                                                 337
	13.4 历史数据查询                                                               342
		13.4.1 查询历史活动及表单                                                       342
		13.4.2 查询已归档流程                                                           343
	13.5 基于MyBatis的CustomSql查询                                                 344
		13.5.1 定义Mapper接口                                                           346
		13.5.2 展示数据                                                                 347
	13.6 本章小结                                                                   347
第14章 管理员特性                                                               348
	14.1 流程状态                                                                   348
		14.1.1 流程定义状态                                                             348
		14.1.2 作业查询                                                                 351
		14.1.3 流程实例状态                                                             353
	14.2 作业管理                                                                   355
		14.2.1 作业执行原理                                                             356
		14.2.2 作业执行异常                                                             356
		14.2.3 独占与异步                                                               358
	14.3 删除流程实例                                                               362
	14.4 流程定义权限控制                                                           364
		14.4.1 权限拦截                                                                 364
		14.4.2 设置候选启动人和候选启动组                                               366
		14.4.3 读取候选启动数据                                                         368
	14.5 读取引擎属性                                                               370
	14.6 数据库查询                                                                 370
	14.7 用户与组                                                                   372
	14.8 本章小结                                                                   373
第四部分 高级篇
第15章 集成WebService                                                           375
	15.1 发布WebService服务                                                         376
	15.2 在流程中定义WebService任务                                                 379
	15.3 在流程中调用WebService                                                     381
	15.4 本章小结                                                                   382
第16章 集成规则引擎                                                             384
	16.1 定义流程与规则                                                             384
		16.1.1 部署规则文件                                                             386
		16.1.2 单元测试                                                                 386
	16.2 本章小结                                                                   388
第17章 集成JPA                                                                  389
	17.1 配置JPA                                                                    389
		17.1.1 Standalone模式                                                           390
		17.1.2 Spring模式                                                               390
	17.2 JPA版本的请假流程                                                          391
		17.2.1 启动流程时持久化JPA实体                                                  392
		17.2.2 更改JPA实体属性                                                          395
		17.2.3 清理历史表单数据                                                         398
	17.3 本章小结                                                                   399
第18章 集成ESB                                                                  400
	18.1 Camel简介与快速入门                                                        400
	18.2 在流程中调用Camel                                                          402
		18.2.1 Camel依赖及配置                                                          403
		18.2.2 定义Camel路由                                                            404
		18.2.3 执行单元测试                                                             405
		18.2.4 URI输入参数                                                              405
		18.2.5 URI输出参数                                                              407
	18.3 异步Camel任务                                                              408
	18.4 在Camel中启动流程                                                          408
	18.5 集成Mule                                                                   409
		18.5.1 Mule快速入门                                                             410
		18.5.2 Mule、Spring与Activiti集成                                               411
		18.5.3 在流程中调用Mule                                                         413
	18.6 本章小结                                                                   415
第19章 统一身份管理                                                             416
	19.1 一套典型的身份系统                                                         416
	19.2 引擎身份接口方式                                                           418
	19.3 用视图代替物理表                                                           423
	19.4 集成LDAP                                                                   423
	19.5 本章小结                                                                   426
第20章 REST服务                                                                 427
	20.1 通信协议简介                                                               427
	20.2 REST API概述                                                               428
	20.3 发布REST API                                                               430
		20.3.1 通过浏览器访问                                                           431
		20.3.2 通过HttpClient访问                                                       432
		20.3.3 通过Restlet访问                                                          433
		20.3.4 通过Apache CXF访问                                                       434
	20.4 集成REST API                                                               434
		20.4.1 依赖及配置文件                                                           435
		20.4.2 通过Ajax访问                                                             436
	20.5 完整示例                                                                   437
		20.5.1 部署流程                                                                 438
		20.5.2 查询Deployment                                                           439
		20.5.3 查询流程定义                                                             440
		20.5.4 启动流程                                                                 441
		20.5.5 读取流程变量                                                             445
		20.5.6 查询任务                                                                 446
		20.5.7 签收任务                                                                 448
		20.5.8 完成任务                                                                 448
		20.5.9 查询历史数据                                                             450
	20.6 集成流程图跟踪组件Diagram Viewer                                           451
		20.6.1 准备资源文件                                                             451
		20.6.2 准备配置文件                                                             451
		20.6.3 访问Diagram Viewer跟踪流程                                               452
	20.7 基于REST服务搭建流程中心                                                   454
		20.7.1 基础架构                                                                 455
		20.7.2 表单模式选型                                                             456
		20.7.3 统一的组件                                                               457
		20.7.4 事务管理                                                                 457
	20.8 集成流程设计器Activiti Modeler                                             457
		20.8.1 准备资源文件                                                             458
		20.8.2 准备配置文件                                                             459
		20.8.3 更改默认配置                                                             460
		20.8.4 创建模型                                                                 460
		20.8.5 导出模型的流程XML                                                        462
		20.8.6 把模型转换为流程定义                                                     463
		20.8.7 把流程定义转换为模型                                                     464
		20.8.8 删除模型                                                                 466
	20.9 本章小结                                                                   466
第21章 入侵Activiti                                                             467
	21.1 解析BPMN文件                                                               467
		21.1.1 BpmnModel对象与XML之间的转换                                             468
		21.1.2 动态创建流程                                                             471
		21.1.3 BPMN解析处理器                                                           474
	21.2 全局事件处理器                                                             478
		21.2.1 定义事件处理器                                                           480
		21.2.2 处理捕获的事件                                                           484
		21.2.3 事件处理器的异常处理                                                     486
		21.2.4 动态注册事件处理器                                                       487
		21.2.5 任务自动转办                                                             488
		21.2.6 事件日志                                                                 491
	21.3 命令与拦截器                                                               494
		21.3.1 命令与拦截器运行机制                                                     495
		21.3.2 自定义命令                                                               497
		21.3.3 命令拦截器                                                               499
	21.4 流程虚拟机—PVM                                                            501
		21.4.1 简述PVM                                                                  501
		21.4.2 Hello PVM                                                                501
		21.4.3 PVM进阶                                                                  504
	21.5 本章小结489
