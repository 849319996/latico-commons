目录	7
序	14
前言	16
第 1 章　初识Kafka	20
	1.1　发布与订阅消息系统	20
		1.1.1　如何开始	21
		1.1.2　独立的队列系统	22
	1.2　Kafka登场	23
		1.2.1　消息和批次	23
		1.2.2　模式	23
		1.2.3　主题和分区	24
		1.2.4　生产者和消费者	24
		1.2.5　broker和集群	25
		1.2.6　多集群	26
	1.3　为什么选择Kafka	27
		1.3.1　多个生产者	27
		1.3.2　多个消费者	27
		1.3.3　基于磁盘的数据存储	28
		1.3.4　伸缩性	28
		1.3.5　高性能	28
	1.4　数据生态系统	28
	1.5　起源故事	30
		1.5.1　LinkedIn的问题	30
		1.5.2　Kafka的诞生	31
		1.5.3　走向开源	31
		1.5.4　命名	32
	1.6　开始Kafka之旅	32
第 2 章　安装Kafka	33
	2.1　要事先行	33
		2.1.1　选择操作系统	33
		2.1.2　安装Java	33
		2.1.3　安装Zookeeper	34
	2.2　安装Kafka Broker	36
	2.3　broker配置	37
		2.3.1　常规配置	37
		2.3.2　主题的默认配置	38
	2.4　硬件的选择	42
		2.4.1　磁盘吞吐量	42
		2.4.2　磁盘容量	42
		2.4.3　内存	42
		2.4.4　网络	43
		2.4.5　CPU	43
	2.5　云端的Kafka	43
	2.6　Kafka集群	43
		2.6.1　需要多少个broker	44
		2.6.2　broker 配置	44
		2.6.3　操作系统调优	45
	2.7　生产环境的注意事项	47
		2.7.1　垃圾回收器选项	47
		2.7.2　数据中心布局	48
		2.7.3　共享Zookeeper	48
	2.8　总结	49
第 3 章　Kafka生产者——向Kafka写入数据	50
	3.1　生产者概览	51
	3.2　创建Kafka生产者	52
	3.3　发送消息到Kafka	53
		3.3.1　同步发送消息	54
		3.3.2　异步发送消息	54
	3.4　生产者的配置	55
	3.5　序列化器	58
		3.5.1　自定义序列化器	58
		3.5.2　使用Avro序列化	60
		3.5.3　在Kafka里使用Avro	61
	3.6　分区	64
	3.7　旧版的生产者API	65
	3.8　总结	66
第 4 章　Kafka消费者——从Kafka读取数据	67
	4.1　KafkaConsumer概念	67
		4.1.1　消费者和消费者群组	67
		4.1.2　消费者群组和分区再均衡	70
	4.2　创建Kafka消费者	71
	4.3　订阅主题	72
	4.4　轮询	72
	4.5　消费者的配置	74
	4.6　提交和偏移量	76
		4.6.1　自动提交	77
		4.6.2　提交当前偏移量	78
		4.6.3　异步提交	78
		4.6.4　同步和异步组合提交	80
		4.6.5　提交特定的偏移量	80
	4.7　再均衡监听器	81
	4.8　从特定偏移量处开始处理记录	83
	4.9　如何退出	85
	4.10　反序列化器	86
	4.11　独立消费者——为什么以及怎样使用没有群组的消费者	90
	4.12　旧版的消费者API	90
	4.13　总结	91
第 5 章　深入Kafka	92
	5.1　集群成员关系	92
	5.2　控制器	93
	5.3　复制	93
	5.4　处理请求	95
		5.4.1　生产请求	97
		5.4.2　获取请求	97
		5.4.3　其他请求	99
	5.5　物理存储	100
		5.5.1　分区分配	100
		5.5.2　文件管理	101
		5.5.3　文件格式	102
		5.5.4　索引	103
		5.5.5　清理	103
		5.5.6　清理的工作原理	103
		5.5.7　被删除的事件	105
		5.5.8　何时会清理主题	105
	5.9　总结	105
第 6 章　可靠的数据传递	106
	6.1　可靠性保证	106
	6.2　复制	107
	6.3　broker配置	108
		6.3.1　复制系数	108
		6.3.2　不完全的首领选举	109
		6.3.3　最少同步副本	110
	6.4　在可靠的系统里使用生产者	111
		6.4.1　发送确认	111
		6.4.2　配置生产者的重试参数	112
		6.4.3　额外的错误处理	113
	6.5　在可靠的系统里使用消费者	113
		6.5.1　消费者的可靠性配置	114
		6.5.2　显式提交偏移量	114
	6.6　验证系统可靠性	116
		6.6.1　配置验证	117
		6.6.2　应用程序验证	117
		6.6.3　在生产环境监控可靠性	118
	6.7　总结	119
第 7 章　构建数据管道	120
	7.1　构建数据管道时需要考虑的问题	121
		7.1.1　及时性	121
		7.1.2　可靠性	121
		7.1.3　高吞吐量和动态吞吐量	122
		7.1.4　数据格式	122
		7.1.5　转换	123
		7.1.6　安全性	123
		7.1.7　故障处理能力	123
		7.1.8　耦合性和灵活性	124
	7.2　如何在Connect API和客户端API之间作出选择	124
	7.3　Kafka Connect	125
		7.3.1　运行Connect	125
		7.3.2　连接器示例——文件数据源和文件数据池	126
		7.3.3　连接器示例——从MySQL到ElasticSearch	128
		7.3.4　深入理解Connect	133
	7.4　Connect之外的选择	135
		7.4.1　用于其他数据存储的摄入框架	135
		7.4.2　基于图形界面的ETL工具	136
		7.4.3　流式处理框架	136
	7.5　总结	136
第 8 章　跨集群数据镜像	137
	8.1　跨集群镜像的使用场景	137
	8.2　多集群架构	138
		8.2.1　跨数据中心通信的一些现实情况	138
		8.2.2　Hub和Spoke架构	139
		8.2.3　双活架构	140
		8.2.4　主备架构	142
		8.2.5　延展集群	146
	8.3　Kafka的MirrorMaker	147
		8.3.1　如何配置	148
		8.3.2　在生产环境部署MirrorMaker	149
		8.3.3　MirrorMaker调优	151
	8.4　其他跨集群镜像方案	153
		8.4.1　优步的uReplicator	153
		8.4.2　Confluent的Replicator	154
	8.5　总结	154
第 9 章　管理Kafka	155
	9.1　主题操作	155
		9.1.1　创建主题	156
		9.1.2　增加分区	157
		9.1.3　删除主题	157
		9.1.4　列出集群里的所有主题	158
		9.1.5　列出主题详细信息	158
	9.2　消费者群组	159
		9.2.1　列出并描述群组	159
		9.2.2　删除群组	161
		9.2.3　偏移量管理	161
	9.3　动态配置变更	162
		9.3.1　覆盖主题的默认配置	162
		9.3.2　覆盖客户端的默认配置	164
		9.3.3　列出被覆盖的配置	164
		9.3.4　移除被覆盖的配置	165
	9.4　分区管理	165
		9.4.1　首选的首领选举	165
		9.4.2　修改分区副本	166
		9.4.3　修改复制系数	169
		9.4.4　转储日志片段	170
		9.4.5　副本验证	171
	9.5　消费和生产	172
		9.5.1　控制台消费者	172
		9.5.2　控制台生产者	174
	9.6　客户端ACL	176
	9.7　不安全的操作	176
		9.7.1　移动集群控制器	176
		9.7.2　取消分区重分配	176
		9.7.3　移除待删除的主题	177
		9.7.4　手动删除主题	177
	9.8　总结	178
第 10 章　监控Kafka	179
	10.1　度量指标基础	179
		10.1.1　度量指标在哪里	179
		10.1.2　内部或外部度量	180
		10.1.3　应用程序健康检测	180
		10.1.4　度量指标的覆盖面	180
	10.2　broker的度量指标	181
		10.2.1　非同步分区	181
		10.2.2　broker度量指标	185
		10.2.3　主题和分区的度量指标	192
		10.2.4　Java虚拟机监控	193
		10.2.5　操作系统监控	194
		10.2.6　日志	195
	10.3　客户端监控	196
		10.3.1　生产者度量指标	196
		10.3.2　消费者度量指标	198
		10.3.3　配额	200
	10.4　延时监控	201
	10.5　端到端监控	202
	10.6　总结	202
第 11 章　流式处理	203
	11.1　什么是流式处理	204
	11.2　流式处理的一些概念	205
		11.2.1　时间	206
		11.2.2　状态	207
		11.2.3　流和表的二元性	207
		11.2.4　时间窗口	208
	11.3　流式处理的设计模式	209
		11.3.1　单个事件处理	210
		11.3.2　使用本地状态	210
		11.3.3　多阶段处理和重分区	212
		11.3.4　使用外部查找——流和表的连接	212
		11.3.5　流与流的连接	214
		11.3.6　乱序的事件	214
		11.3.7　重新处理	215
	11.4　Streams示例	216
		11.4.1　字数统计	216
		11.4.2　股票市场统计	218
		11.4.3　填充点击事件流	220
	11.5　Kafka Streams的架构概览	221
		11.5.1　构建拓扑	221
		11.5.2　对拓扑进行伸缩	222
		11.5.3　从故障中存活下来	224
	11.6　流式处理使用场景	224
	11.7　如何选择流式处理框架	225
	11.8　总结	227
附录A　在其他操作系统上安装Kafka	228
作者介绍	233
封面介绍	233
